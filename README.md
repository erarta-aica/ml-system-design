# Проект AICA - сервис расчитывающий калорийность еды по фотографии

---

## 1. Постановка задачи

### 1.1 Описание задачи
Цель проекта — разработать сервис, который позволяет пользователям рассчитывать калорийность блюд на основе загруженных фотографий. Система должна выполнять классификацию еды, оценивать её вес и на основании пищевой ценности продуктов предоставлять информацию о калориях. 

### 1.2 Основные пользователи
1. **Индивидуальные пользователи**:
   - Люди, следящие за своим питанием.
   - Спортсмены, подсчитывающие калории для достижения целей.
2. **Фитнес и диетологические сервисы**:
   - Приложения для управления питанием.
   - Медицинские учреждения для анализа диет пациентов.
3. **Рестораны и службы доставки**:
   - Для анализа популярности блюд и их калорийности.

### 1.3 Основные возможности
- Анализ изображения для определения типа еды.
- Оценка веса блюда.
- Расчет калорийности на основе предоставленных данных.
- История обработанных изображений с результатами.
- Возможность исправления данных пользователем.

### 1.4 Ключевые показатели качества
- **Точность классификации еды**: ≥ 90%.
- **Погрешность оценки веса**: ≤ 10%.
- **Скорость обработки**: ≤ 3 секунды.

### 1.5 Границы задачи
- Система поддерживает только отдельные блюда на одном изображении.
- Классификация ограничена списком из 200 категорий еды.
- Не учитываются дополнительные ингредиенты (например, соусы или гарниры).

---

## 2. Анализ данных

### 2.1 Источники данных
1. **Публичные датасеты**:
   - Food-101, FoodX-251 — изображения блюд с разметкой.
   - Таблицы пищевой ценности (например, USDA FoodData Central).
2. **Собственные данные**:
   - Собранные фотографии от пользователей.
   - Ручная аннотация изображений (тип блюда, вес, калорийность).
3. **Дополнительные источники**:
   - Изображения из социальных сетей (с соблюдением правил использования данных).

### 2.2 Предварительная обработка данных
- **Очистка данных**:
  - Удаление нерелевантных изображений (пустые тарелки, текст).
  - Фильтрация повреждённых и размытных изображений.
- **Аугментация**:
  - Вращение изображений.
  - Изменение яркости, контраста.
  - Добавление случайного шума.
- **Унификация формата**:
  - Преобразование изображений к размеру 224x224 пикселей.
  - Нормализация пикселей (0–1).

### 2.3 Этапы решения задачи

## Этап 1. Подготовка данных

### Описание данных и сущностей
* Набор фотографий блюд с размеченной калорийностью
* Метаданные: название блюда, вес порции, состав ингредиентов
* Выявленные проблемы:
  * Недостаточное разнообразие ракурсов съемки
  * Неравномерное освещение
  * Отсутствие стандартизации размера порций

### Процесс генерации данных
* Источники данных:
  * Food-101 датасет
  * Food-5K датасет
  * Ручная разметка экспертами-диетологами
  * Сбор через мобильное приложение
* Формат данных:
  * Изображения: JPG/PNG
  * Аннотации: JSON

### Работа с недостатком данных
* Требуется дополнительно 10000+ размеченных фотографий
* Методы решения:
  * Краудсорсинг через мобильное приложение
  * Data augmentation существующих данных
  * Синтетическая генерация данных
* Валидация качества через перекрестную проверку экспертами

### Конфиденциальность
* Отсутствие хранения персональных данных пользователей
* Анонимизация фотографий при загрузке
* Безопасное хранение метаданных без чувствительной информации

## Этап 2. Подготовка прогнозных моделей

### ML-метрики и функции потерь
* Основная метрика: Mean Absolute Percentage Error (MAPE)
* Дополнительные метрики:
  * MSE (Mean Squared Error)
  * RMSE (Root Mean Squared Error)
* Функция потерь: комбинация L1 и L2 для оптимального баланса точности

### Схема ML-валидации
* Стратифицированная 5-fold кросс-валидация
* Выделенный тестовый набор для финальной оценки
* Валидация на различных категориях блюд

### Структура бейзлайна
* Архитектура: CNN на базе ResNet50
* Предобработка данных:
  * Нормализация изображений
  * Аугментация данных
  * Resize до стандартного размера
* Базовые признаки:
  * Цветовые гистограммы
  * Текстурные характеристики

### Стратегии развития решения
* Тестирование современных архитектур:
  * EfficientNet
  * Vision Transformer
* Мультимодальный подход с учетом текстового описания
* Оптимизация гиперпараметров через Bayesian Optimization

## Этап 3. Разработка системы распознавания

### Компоненты системы
* Модуль предобработки изображений
* Детектор объектов для выделения блюд
* Классификатор типов блюд
* Калькулятор калорийности

### Интеграция компонентов
* REST API для взаимодействия с frontend
* Асинхронная обработка запросов
* Система кэширования результатов

## Этап 4. Тестирование и оптимизация

### Функциональное тестирование
* Проверка точности распознавания различных типов блюд
* Тестирование при различных условиях освещения
* Оценка скорости работы системы

### Оптимизация производительности
* Квантизация моделей для ускорения инференса
* Распараллеливание обработки запросов
* Оптимизация пайплайна инференса

---

EDA

# Отчет по разведочному анализу данных (EDA)
## Проект: Оценка калорийности блюд по фотографиям

### 1. Оценка состава и объема данных

#### 1.1 Общая информация о датасете
- **Источник данных**: Food101 Dataset
- **Объем выборки**: 1000 изображений
- **Количество категорий**: 10 различных блюд
- **Размер датасета**: ~500MB
- **Формат изображений**: RGB, различные разрешения

#### 1.2 Распределение по категориям
```python
Категория           Количество    Средняя калорийность
apple_pie           98           297.5 ккал
baby_back_ribs      102          605.2 ккал
baklava             97           348.7 ккал
beef_carpaccio      101          198.3 ккал
beef_tartare        99           251.6 ккал
beet_salad          103          148.9 ккал
beignets            98           397.4 ккал
bibimbap            101          503.8 ккал
bread_pudding       100          452.1 ккал
breakfast_burrito   101          547.9 ккал
```

### 2. Анализ качества данных

#### 2.1 Характеристики изображений
- **Разрешение**: варьируется от 512x512 до 1024x1024 пикселей
- **Соотношение сторон**: преимущественно 1:1 и 4:3
- **Формат цвета**: RGB (3 канала)
- **Среднее качество**: высокое, без значительных артефактов сжатия

#### 2.2 Пропущенные значения
- Отсутствуют пропущенные значения в основных характеристиках
- Все изображения доступны и читаемы
- Все категории имеют примерно равное количество образцов

### 3. Визуализации и анализ

#### 3.1 Распределение калорийности

**Выводы**:
1. Распределение калорийности близко к нормальному
2. Диапазон калорий: 150-600 ккал
3. Четкая сегментация на низко- и высококалорийные блюда
4. Медианная калорийность: 375 ккал

#### 3.2 Анализ визуальных характеристик

**Ключевые наблюдения**:
1. Яркость изображений:
   - Среднее значение: 0.48
   - Стандартное отклонение: 0.12
   - Корреляция с калорийностью: -0.32

2. Насыщенность цвета:
   - Среднее значение: 0.22
   - Стандартное отклонение: 0.08
   - Корреляция с калорийностью: 0.28

#### 3.3 Корреляции между характеристиками

**Значимые корреляции**:
1. Калории - Яркость: -0.32
2. Калории - Насыщенность: 0.28
3. Яркость - Насыщенность: -0.45

### 4. Основные выводы

1. **Качество датасета**:
   - Хорошо сбалансированное распределение классов
   - Высокое качество изображений
   - Отсутствие пропущенных данных
   - Достаточный объем для начального анализа

2. **Особенности данных**:
   - Четкая сегментация на категории по калорийности
   - Выраженные визуальные паттерны для разных категорий блюд
   - Значимые корреляции между визуальными характеристиками и калорийностью

3. **Потенциальные признаки для модели**:
   - Яркость изображения (коррелирует с калорийностью)
   - Насыщенность цветов
   - Соотношение сторон изображения
   - Текстурные характеристики

4. **Ограничения датасета**:
   - Ограниченное количество категорий (10 из 101)
   - Отсутствие информации о размере порций
   - Возможная необходимость в дополнительной аугментации данных

### 5. Рекомендации для дальнейшей работы

1. **Предобработка данных**:
   - Стандартизация размеров изображений
   - Нормализация яркости и контраста
   - Аугментация данных для увеличения разнообразия

2. **Разработка модели**:
   - Использование transfer learning
   - Учет визуальных характеристик как дополнительных признаков
   - Многозадачное обучение (категория + калории)

3. **Расширение датасета**:
   - Добавление новых категорий блюд
   - Сбор дополнительных метаданных (размер порции, ингредиенты)
   - Включение региональных вариаций блюд

### 6. Используемые инструменты и код

Весь код анализа доступен в репозитории:
- `data_processing/` - скрипты обработки данных
- `analysis/` - код анализа и визуализации
- `results/` - результаты анализа и визуализации

Проект находится в директории /food-calorie-eda

Чтобы запустить проект:
1. Виртуальное окружение:
```
python -m venv venv
source venv/bin/activate  # для Linux/Mac
venv\Scripts\activate  # для Windows
```
2. Зависимости
```
pip install -r requirements.txt

```
3. Анализ
```
python main.py
```

Код автоматически:
- Загрузит датасет Food101
- Выберет подмножество из 1000 изображений
- Проведет анализ и создаст визуализации
- Сохранит результаты в папку results





## Блок-схема проекта
![Схема проекта](https://github.com/erarta-aica/ml-system-design/blob/main/AICA.png)
